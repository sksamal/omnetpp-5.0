<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>1. Getting started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body><!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">1. Getting started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>UP: <a class="el" href="index.html#contents">Contents</a></p>
<p>Since the most common application area of OMNeT++ is the simulation of telecommunications networks, we'll borrow our topic from there. For a start, let us begin with a "network" that consists of two nodes. The nodes will do something simple: one of the nodes will create a packet, and the two nodes will keep passing the same packet back and forth. We'll call the nodes "tic" and "toc".</p>
<p>Here are the steps you take to implement your first simulation from scratch:</p>
<p>1. Create a working directory called tictoc, and cd to this directory.</p>
<p>2. Describe your example network by creating a topology file. Topology files are written in the NED language (Network Definition). A NED topology file is a text file that identifies the network's nodes and the links between them. You can create it with your favourite text editor. </p><dl class="section note"><dt>Note</dt><dd>You can find a detailed description of the NED language in <a href="../manual/usman.html#cha:ned-lang" target="blank">Section 3</a> of the OMNeT++ manual (it's also in the <code>doc</code> directory of your OMNeT++ installation).</dd></dl>
<p>Let's call it tictoc1.ned:</p>
 <div class="fragment"><div class="line">simple <a class="code" href="classTxc1.html">Txc1</a></div><div class="line">{</div><div class="line">    gates:</div><div class="line">        input in;</div><div class="line">        output out;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Two instances (tic and toc) of Txc1 connected both ways.</span></div><div class="line"><span class="comment">// Tic and toc will pass messages to one another.</span></div><div class="line"><span class="comment">//</span></div><div class="line">network Tictoc1</div><div class="line">{</div><div class="line">    submodules:</div><div class="line">        tic: <a class="code" href="classTxc1.html">Txc1</a>;</div><div class="line">        toc: <a class="code" href="classTxc1.html">Txc1</a>;</div><div class="line">    connections:</div><div class="line">        tic.out --&gt; {  delay = 100ms; } --&gt; toc.in;</div><div class="line">        tic.in &lt;-- {  delay = 100ms; } &lt;-- toc.out;</div><div class="line">}</div></div><!-- fragment --></p>
<p>The file is best read from the bottom up. Here's what it says:</p>
<ul>
<li>Tictoc1 is a network, which is assembled from two submodules, tic and toc. tic and toc are instances of the same module type called <a class="el" href="classTxc1.html">Txc1</a>. We connect tic's output gate (named out) to toc's input gate (named in), and vica versa (<code>network ... { ... }</code>). There will be a 100ms propagation delay both ways;</li>
<li><a class="el" href="classTxc1.html">Txc1</a> is a simple module type (which means it is atomic on NED level, and will be implemented in C++). <a class="el" href="classTxc1.html">Txc1</a> has one input gate named in, and one output gate named out (<code>simple ... { ... }</code>).</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>You can find more information on Simple modules in <a href="../manual/usman.html#cha:simple-modules" target="_blank">Section 4</a> of the OMNeT++ manual.</dd></dl>
<p>3. We now need to implement the functionality of the simple module <a class="el" href="classTxc1.html">Txc1</a>. This is achieved by writing a C++ file <a class="el" href="txc1.cc.html">txc1.cc</a> :</p>
 <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;omnetpp.h&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceomnetpp.html">omnetpp</a>;</div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="classTxc1.html">Txc1</a> : <span class="keyword">public</span> <a class="codeRef" doxygen="/home/default/omnetpp/doc/api/opptags.xml:../api/" href="../api/classomnetpp_1_1cSimpleModule.html">cSimpleModule</a></div><div class="line">{</div><div class="line">  <span class="keyword">protected</span>:</div><div class="line">    <span class="comment">// The following redefined virtual function holds the algorithm.</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> initialize() <span class="keyword">override</span>;</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> handleMessage(<a class="codeRef" doxygen="/home/default/omnetpp/doc/api/opptags.xml:../api/" href="../api/classomnetpp_1_1cMessage.html">cMessage</a> *msg) <span class="keyword">override</span>;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// The module class needs to be registered with OMNeT++</span></div><div class="line"><a class="code" href="txc1_8cc.html#a5ac407c43df69e3adc074c5c56d511ff">Define_Module</a>(<a class="code" href="classTxc1.html">Txc1</a>);</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="classTxc1.html#ae20e2856ba89c3f38223b0027097adbe">Txc1::initialize</a>()</div><div class="line">{</div><div class="line">    <span class="comment">// Initialize is called at the beginning of the simulation.</span></div><div class="line">    <span class="comment">// To bootstrap the tic-toc-tic-toc process, one of the modules needs</span></div><div class="line">    <span class="comment">// to send the first message. Let this be `tic&#39;.</span></div><div class="line"></div><div class="line">    <span class="comment">// Am I Tic or Toc?</span></div><div class="line">    <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;tic&quot;</span>, getName()) == 0) {</div><div class="line">        <span class="comment">// create and send first message on gate &quot;out&quot;. &quot;tictocMsg&quot; is an</span></div><div class="line">        <span class="comment">// arbitrary string which will be the name of the message object.</span></div><div class="line">        <a class="codeRef" doxygen="/home/default/omnetpp/doc/api/opptags.xml:../api/" href="../api/classomnetpp_1_1cMessage.html">cMessage</a> *msg = <span class="keyword">new</span> <a class="codeRef" doxygen="/home/default/omnetpp/doc/api/opptags.xml:../api/" href="../api/classomnetpp_1_1cMessage.html">cMessage</a>(<span class="stringliteral">&quot;tictocMsg&quot;</span>);</div><div class="line">        send(msg, <span class="stringliteral">&quot;out&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="classTxc1.html#a728683f3d6d1b5271c1aa8d0ccf761a2">Txc1::handleMessage</a>(<a class="codeRef" doxygen="/home/default/omnetpp/doc/api/opptags.xml:../api/" href="../api/classomnetpp_1_1cMessage.html">cMessage</a> *msg)</div><div class="line">{</div><div class="line">    <span class="comment">// The handleMessage() method is called whenever a message arrives</span></div><div class="line">    <span class="comment">// at the module. Here, we just send it to the other module, through</span></div><div class="line">    <span class="comment">// gate `out&#39;. Because both `tic&#39; and `toc&#39; does the same, the message</span></div><div class="line">    <span class="comment">// will bounce between the two.</span></div><div class="line">    send(msg, <span class="stringliteral">&quot;out&quot;</span>); <span class="comment">// send out the message</span></div><div class="line">}</div></div><!-- fragment --></p>
<p>The <a class="el" href="classTxc1.html">Txc1</a> simple module type is represented by the C++ class <a class="el" href="classTxc1.html">Txc1</a>, which has to be subclassed from cSimpleModule, and registered in OMNeT++ with the <a class="el" href="txc1_8cc.html#a5ac407c43df69e3adc074c5c56d511ff">Define_Module()</a> macro.</p>
<p>We redefine two methods from cSimpleModule: initialize() and handleMessage(). They are invoked from the simulation kernel: the first one only once, and the second one whenever a message arrives at the module.</p>
<p>In initialize() we create a message object (cMessage), and send it out on gate <code>out</code>. Since this gate is connected to the other module's input gate, the simulation kernel will deliver this message to the other module in the argument to handleMessage() &ndash; after a 100ms propagation delay assigned to the link in the NED file. The other module just sends it back (another 100ms delay), so it will result in a continuous ping-pong.</p>
<p>Messages (packets, frames, jobs, etc) and events (timers, timeouts) are all represented by cMessage objects (or its subclasses) in OMNeT++. After you send or schedule them, they will be held by the simulation kernel in the "scheduled events" or "future events" list until their time comes and they are delivered to the modules via handleMessage().</p>
<p>Note that there is no stopping condition built into this simulation: it would continue forever. You will be able to stop it from the GUI. (You could also specify a simulation time limit or CPU time limit in the configuration file, but we don't do that in the tutorial.)</p>
<p>4. We now create the Makefile which will help us to compile and link our program to create the executable tictoc:</p>
<div class="fragment"><div class="line">$ opp_makemake</div></div><!-- fragment --><p>This command should have now created a Makefile in the working directory tictoc.</p>
<dl class="section note"><dt>Note</dt><dd>Windows+MSVC users: the command is <code>opp_<em>n</em>makemake</code>, and it will create <code>Makefile.vc</code>. Note: MSVC is only supported in the commercial version OMNEST.</dd></dl>
<p>5. Let's now compile and link our very first simulation by issuing the make command:</p>
<div class="fragment"><div class="line">$ make</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Windows+MSVC: type <code>nmake -f Makefile.vc</code>. If you get <em>'nmake' is not recognized as an internal or external command...</em>, find <code>vcvars32.bat</code> somewhere in the MSVC directories, and run it first in every command window in which you want to compile. Note: MSVC is only supported in the commercial version OMNEST.</dd></dl>
<p>If there are compilation errors, you need to rectify those and repeat the make until you get an error-free compilation and linking.</p>
<dl class="section note"><dt>Note</dt><dd>It might be more convenient to use the OMNeT++ IDE for the tutorial. Creating a new project, adding files and building your project is fully automated in the IDE. There is no need to manually create the <code>Makefile</code> either.</dd></dl>
<p>6. If you start the executable now, it will complain that it cannot find the file omnetpp.ini, so you have to create one. omnetpp.ini tells the simulation program which network you want to simulate (yes, several networks can live in the same simulation program), you can pass parameters to the model, explicitly specify seeds for the random number generators etc.</p>
<p>Create the following very simple omnetpp.ini:</p>
<div class="fragment"><div class="line">[General]</div><div class="line">network = Tictoc1</div></div><!-- fragment --><p>tictoc2 and further steps will all share the following omnetpp.ini:</p>
<div class="fragment"><div class="line"># This file is shared by all tictoc simulations.</div><div class="line"># Lines beginning with `#&#39; are comments</div><div class="line"></div><div class="line">[General]</div><div class="line"># nothing here</div><div class="line"></div><div class="line">[Config Tictoc1]</div><div class="line">network = Tictoc1</div><div class="line"></div><div class="line">[Config Tictoc2]</div><div class="line">network = Tictoc2</div><div class="line"></div><div class="line">[Config Tictoc3]</div><div class="line">network = Tictoc3</div><div class="line"></div><div class="line">[Config Tictoc4]</div><div class="line">network = Tictoc4</div><div class="line">Tictoc4.toc.limit = 5</div><div class="line"></div><div class="line">[Config Tictoc5]</div><div class="line">network = Tictoc5</div><div class="line">**.limit = 5</div><div class="line"></div><div class="line">[Config Tictoc6]</div><div class="line">network = Tictoc6</div><div class="line"></div><div class="line">[Config Tictoc7]</div><div class="line">network = Tictoc7</div><div class="line"># argument to exponential() is the mean; truncnormal() returns values from</div><div class="line"># the normal distribution truncated to nonnegative values</div><div class="line">Tictoc7.tic.delayTime = exponential(3s)</div><div class="line">Tictoc7.toc.delayTime = truncnormal(3s,1s)</div><div class="line"></div><div class="line">[Config Tictoc8]</div><div class="line">network = Tictoc8</div><div class="line"></div><div class="line">[Config Tictoc9]</div><div class="line">network = Tictoc9</div><div class="line"></div><div class="line">[Config Tictoc10]</div><div class="line">network = Tictoc10</div><div class="line"></div><div class="line">[Config Tictoc11]</div><div class="line">network = Tictoc11</div><div class="line"></div><div class="line">[Config Tictoc12]</div><div class="line">network = Tictoc12</div><div class="line"></div><div class="line">[Config Tictoc13]</div><div class="line">network = Tictoc13</div><div class="line"></div><div class="line">[Config Tictoc14]</div><div class="line">network = Tictoc14</div><div class="line"></div><div class="line">[Config Tictoc15]</div><div class="line">network = Tictoc15</div><div class="line">record-eventlog = true</div><div class="line"></div><div class="line">[Config Tictoc16]</div><div class="line">network = Tictoc16</div><div class="line">**.tic[1].hopCount.result-recording-modes = +histogram</div><div class="line">**.tic[0..2].hopCount.result-recording-modes = -vector</div></div><!-- fragment --><p>7. Once you complete the above steps, you launch the simulation by issuing this command:</p>
<div class="fragment"><div class="line">$ ./tictoc</div></div><!-- fragment --><p>and hopefully you should now get the OMNeT++ simulation window.</p>
<dl class="section note"><dt>Note</dt><dd>To run the simulation from the IDE, just right click on <em>omnetpp.ini</em> and select <em>Run as</em>, then <em>OMNeT++ Simulation</em>.</dd></dl>
<p>8. Press the Run button on the toolbar to start the simulation. What you should see is that tic and toc are exchanging messages with each other.</p>
<div class="image">
<img src="step1.png" />
</div>
<p>The main window toolbar displays the simulated time. This is virtual time, it has nothing to do with the actual (or wall-clock) time that the program takes to execute. Actually, how many seconds you can simulate in one real-world second depends highly on the speed of your hardware and even more on the nature and complexity of the simulation model itself.</p>
<p>Note that it takes zero simulation time for a node to process the message. The only thing that makes the simulation time pass in this model is the propagation delay on the connections.</p>
<p>9. You can play with slowing down the animation or making it faster with the slider at the top of the graphics window. You can stop the simulation by hitting F8 (equivalent to the STOP button on the toolbar), single-step through it (F4), run it with (F5) or without (F6) animation. F7 (express mode) completely turns off tracing features for maximum speed. Note the event/sec and simsec/sec gauges on the status bar of the main window (only visible when the simulation is running in fast or express mode).</p>
<p>10. You can exit the simulation program by clicking its Close icon or choosing File|Exit.</p>
<dl class="section note"><dt>Note</dt><dd>There are some typical mistakes that people who are new to OMNeT++ make:</dd>
<dd>
- By default, the module type name must be the same in both the .ned and the .cc files. It is a common mistake to either forget the <a class="el" href="txc1_8cc.html#a5ac407c43df69e3adc074c5c56d511ff">Define_Module()</a> macro, or mistype the module name so it is not the same in the .ned and .cc files. These mistakes yield the following errors, respectively:</dd>
<dd>
<em>Error in module (<a class="elRef" doxygen="/home/default/omnetpp/doc/api/opptags.xml:../api/" href="../api/classomnetpp_1_1cModule.html">omnetpp::cModule</a>) Tictoc1 (id=1) during network setup: Class "Txc1" not found &ndash; perhaps its code was not linked in, or the class wasn't registered with <a class="elRef" doxygen="/home/default/omnetpp/doc/api/opptags.xml:../api/" href="../api/group__RegMacros.html#gadbca479a455e4ba1bb47e9cb699e8765">Register_Class()</a>, or in the case of modules and channels, with <a class="el" href="txc1_8cc.html#a5ac407c43df69e3adc074c5c56d511ff">Define_Module()</a>/Define_Channel().</em></dd>
<dd>
or</dd>
<dd>
<em>Error in module (<a class="elRef" doxygen="/home/default/omnetpp/doc/api/opptags.xml:../api/" href="../api/classomnetpp_1_1cModule.html">omnetpp::cModule</a>) TicToc1 (id=1) during network setup: Submodule tic: cannot resolve module type '<a class="el" href="classTxc1.html">Txc1</a>' (not in the loaded NED files?), at /omnetpp-5.0/samples/tictoc/tictoc1.ned:26.</em></dd>
<dd>
- Also, you must run <code>opp_makemake</code> and <code>make</code> after adding a <code>.cc</code> file to the project. Failing to do so will be indicated by the first error message above. If you use the OMNeT++ IDE, this is done automatically.</dd></dl>
<p>Sources: <a class="el" href="tictoc1.ned.html">tictoc1.ned</a>, <a class="el" href="txc1.cc.html">txc1.cc</a>, <a class="el" href="omnetpp.ini.html">omnetpp.ini</a></p>
<p>NEXT: <a class="el" href="part2.html">2. Enhancing the 2-node TicToc</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 14 2016 13:41:03 for Tictoc Tutorial by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
